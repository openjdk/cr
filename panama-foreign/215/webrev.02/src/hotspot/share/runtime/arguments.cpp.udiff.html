<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/runtime/arguments.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../prims/whitebox.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="deoptimization.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/runtime/arguments.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -3305,11 +3305,11 @@</span>
    // Populates the JavaVMInitArgs object represented by this
    // ScopedVMInitArgs object with the arguments in options.  The
    // allocated memory is deleted by the destructor.  If this method
    // returns anything other than JNI_OK, then this object is in a
    // partially constructed state, and should be abandoned.
<span class="udiff-line-modified-removed">-   jint set_args(GrowableArray&lt;JavaVMOption&gt;* options) {</span>
<span class="udiff-line-modified-added">+   jint set_args(const GrowableArrayView&lt;JavaVMOption&gt;* options) {</span>
      _is_set = true;
      JavaVMOption* options_arr = NEW_C_HEAP_ARRAY_RETURN_NULL(
          JavaVMOption, options-&gt;length(), mtArguments);
      if (options_arr == NULL) {
        return JNI_ENOMEM;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -3363,27 +3363,25 @@</span>
      assert(_args.options == NULL, &quot;shouldn&#39;t be set yet&quot;);
      assert(args_to_insert-&gt;nOptions != 0, &quot;there should be args to insert&quot;);
      assert(vm_options_file_pos != -1, &quot;vm_options_file_pos should be set&quot;);
  
      int length = args-&gt;nOptions + args_to_insert-&gt;nOptions - 1;
<span class="udiff-line-modified-removed">-     GrowableArray&lt;JavaVMOption&gt; *options = new (ResourceObj::C_HEAP, mtArguments)</span>
<span class="udiff-line-modified-removed">-               GrowableArray&lt;JavaVMOption&gt;(length, mtArguments);    // Construct new option array</span>
<span class="udiff-line-modified-added">+     // Construct new option array</span>
<span class="udiff-line-modified-added">+     GrowableArrayCHeap&lt;JavaVMOption, mtArguments&gt; options(length);</span>
      for (int i = 0; i &lt; args-&gt;nOptions; i++) {
        if (i == vm_options_file_pos) {
          // insert the new options starting at the same place as the
          // -XX:VMOptionsFile option
          for (int j = 0; j &lt; args_to_insert-&gt;nOptions; j++) {
<span class="udiff-line-modified-removed">-           options-&gt;push(args_to_insert-&gt;options[j]);</span>
<span class="udiff-line-modified-added">+           options.push(args_to_insert-&gt;options[j]);</span>
          }
        } else {
<span class="udiff-line-modified-removed">-         options-&gt;push(args-&gt;options[i]);</span>
<span class="udiff-line-modified-added">+         options.push(args-&gt;options[i]);</span>
        }
      }
      // make into options array
<span class="udiff-line-modified-removed">-     jint result = set_args(options);</span>
<span class="udiff-line-removed">-     delete options;</span>
<span class="udiff-line-removed">-     return result;</span>
<span class="udiff-line-modified-added">+     return set_args(&amp;options);</span>
    }
  };
  
  jint Arguments::parse_java_options_environment_variable(ScopedVMInitArgs* args) {
    return parse_options_environment_variable(&quot;_JAVA_OPTIONS&quot;, args);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -3476,11 +3474,12 @@</span>
    FREE_C_HEAP_ARRAY(char, buf);
    return retcode;
  }
  
  jint Arguments::parse_options_buffer(const char* name, char* buffer, const size_t buf_len, ScopedVMInitArgs* vm_args) {
<span class="udiff-line-modified-removed">-   GrowableArray&lt;JavaVMOption&gt; *options = new (ResourceObj::C_HEAP, mtArguments) GrowableArray&lt;JavaVMOption&gt;(2, mtArguments);    // Construct option array</span>
<span class="udiff-line-modified-added">+   // Construct option array</span>
<span class="udiff-line-added">+   GrowableArrayCHeap&lt;JavaVMOption, mtArguments&gt; options(2);</span>
  
    // some pointers to help with parsing
    char *buffer_end = buffer + buf_len;
    char *opt_hd = buffer;
    char *wrt = buffer;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -3516,11 +3515,10 @@</span>
            rd++;                             // don&#39;t copy close quote
          } else {
                                              // did not see closing quote
            jio_fprintf(defaultStream::error_stream(),
                        &quot;Unmatched quote in %s\n&quot;, name);
<span class="udiff-line-removed">-           delete options;</span>
            return JNI_ERR;
          }
        } else {
          *wrt++ = *rd++;                     // copy to option string
        }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -3532,20 +3530,17 @@</span>
  
      JavaVMOption option;
      option.optionString = opt_hd;
      option.extraInfo = NULL;
  
<span class="udiff-line-modified-removed">-     options-&gt;append(option);                // Fill in option</span>
<span class="udiff-line-modified-added">+     options.append(option);                // Fill in option</span>
  
      rd++;  // Advance to next character
    }
  
    // Fill out JavaVMInitArgs structure.
<span class="udiff-line-modified-removed">-   jint status = vm_args-&gt;set_args(options);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   delete options;</span>
<span class="udiff-line-removed">-   return status;</span>
<span class="udiff-line-modified-added">+   return vm_args-&gt;set_args(&amp;options);</span>
  }
  
  jint Arguments::set_shared_spaces_flags_and_archive_paths() {
    if (DumpSharedSpaces) {
      if (RequireSharedSpaces) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -4146,17 +4141,17 @@</span>
                &quot;; ignoring UseBiasedLocking flag.&quot; );
      }
      UseBiasedLocking = false;
    }
  
<span class="udiff-line-modified-removed">- #ifdef CC_INTERP</span>
<span class="udiff-line-modified-added">+ #ifdef ZERO</span>
    // Clear flags not supported on zero.
    FLAG_SET_DEFAULT(ProfileInterpreter, false);
    FLAG_SET_DEFAULT(UseBiasedLocking, false);
    LP64_ONLY(FLAG_SET_DEFAULT(UseCompressedOops, false));
    LP64_ONLY(FLAG_SET_DEFAULT(UseCompressedClassPointers, false));
<span class="udiff-line-modified-removed">- #endif // CC_INTERP</span>
<span class="udiff-line-modified-added">+ #endif // ZERO</span>
  
    if (PrintAssembly &amp;&amp; FLAG_IS_DEFAULT(DebugNonSafepoints)) {
      warning(&quot;PrintAssembly is enabled; turning on DebugNonSafepoints to gain additional output&quot;);
      DebugNonSafepoints = true;
    }
</pre>
<center><a href="../prims/whitebox.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="deoptimization.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>